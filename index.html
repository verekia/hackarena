<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
            body {
                background: #311;
            }

            .canvas-container {
                background: #ccc;
                width: 990px;
                height: 500px;
                margin: 100px auto;
            }

        </style>
    </head>
    <body>
        <div class="canvas-container">
            <canvas></canvas>
        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
        <script src="//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
    <script>

var Hackarena = {};

(function() {
    var websocketURL = 'http://' + window.location.host + '/websocket';
    var sock = new SockJS(websocketURL);
    console.log(websocketURL);

    // Game URL Example: /roomname/username/team/class 

    var params = location.pathname.substring(1).split('/');
    var room = params[0];
    var username = params[1];
    var team = params[2];
    var characterClass = params[3];

    $('.canvas-container').append('Room: ' + room + ', Username: ' + username + ', Team: ' + team + ', Class: ' + characterClass);

    sock.onopen = function() {
        var enterRoomMessage = JSON.stringify({
            type: 'ROOM',
            content: room
        });
        sock.send(enterRoomMessage);
    };

    sock.onmessage = function (evt) {
        dispatchMessage(evt.data);
    };

    sock.onclose = function() {
        console.log('Connection closed.');
    };

    $('.js-name').click(function() {
        var nameChangeMessage = JSON.stringify({
            type: 'NAME',
            content: $('.js-input-name').val()
        });
        sock.send(nameChangeMessage);
    });

    var dispatchMessage = function(message) {
        var message = JSON.parse(message);

        if (message.type === 'SIMPLE_MESSAGE') {
            $('.chat-content').append('<p>' + message.content + '.</p>');
        }

        if (message.type === 'USER_MESSAGE') {
            $('.chat-content').append('<p><strong>' + message.content.username + '</strong> says: ' + message.content.message + '</p>');
        }

        if (message.type === 'USER_RENAME') {
            $('.chat-content').append('<p><strong>' + message.content.previousName + '</strong> is now called <strong>' + message.content.newName + '</strong>.</p>');
        }

        if (message.type === 'OTHER_ENTERED_ROOM') {
            $('.chat-content').append('<p><strong>' + message.content + '</strong> entered the room.</p>');
        }

        if (message.type === 'USERS') {
            $('.js-users').html('');
            for (var i = 0, len = message.content.length; i < len; i++) {
                $('.js-users').append('<li>' + message.content[i] + '</li>');
            }
        }

        if (message.type === 'ENTERED_ROOM') {
            $('.js-loading').remove();
            var roomName = message.content.roomName;
            if (message.content.roomName.indexOf('/private/') > 0) {
                var n = message.content.roomName.indexOf('/private/');
                var roomName = message.content.roomName.substring(0, n) + ' (private)';
                $('body').append('Share it: <input class="js-copy-private" value="' + window.location.href + '">');
                $('.js-copy-private').mouseup(function(e){
                    e.preventDefault();
                });
                $('.js-copy-private').focus(function(){
                    this.select();
                });
            }
            $('.js-room-name').html(roomName);
            $('.js-input-name').val(message.content.temporaryName);
        }


    };


    $('.js-send').click(function() {
        var message = JSON.stringify({
            type: 'USER_MESSAGE',
            content: $('.js-input-message').val()
        });
        sock.send(message);
    });

    $('.js-unsupported').click(function() {
        var unsupportedMessage1 = JSON.stringify({
            type: 'UNSUPPORTED',
            content: ''
        });
        console.log('Sending: ' + unsupportedMessage1);
        sock.send(unsupportedMessage1);

        var unsupportedMessage2 = 'Unsupported';
        console.log('Sending: ' + unsupportedMessage2);
        sock.send(unsupportedMessage2);
    });


}(window, Hackarena));

        </script>
    </body>
</html>
